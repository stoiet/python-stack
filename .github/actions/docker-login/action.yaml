name: Docker login
description: Docker login

inputs:
  DOCKERHUB_USER:
    description: DOCKERHUB_USER
    required: true
  DOCKERHUB_TOKEN:
    description: DOCKERHUB_TOKEN
    required: true
  DOCKER_CONFIG:
    description: DOCKER_CONFIG
    required: true
    default: ~/.docker/config.json

runs:
  using: composite
  steps:
    - uses: ./.github/actions/pass
    - uses: ./.github/actions/docker-credentials-helper

    - run: |
        set -eux
        pass init ${{ inputs.DOCKERHUB_USER }}
        pass insert docker-credential-helpers/docker-pass-initialized-check
        pass show docker-credential-helpers/docker-pass-initialized-check
      shell: bash

    - run: docker logout
      shell: bash

    - run: echo '{"credsStore":"pass"}' > ${{ inputs.DOCKER_CONFIG }}
      shell: bash

    - run: cat ${{ inputs.DOCKER_CONFIG }}
      shell: bash

    - run: echo ${{ inputs.DOCKERHUB_TOKEN }} | docker login --username ${{ inputs.DOCKERHUB_USER }} --password-stdin
      shell: bash
